const qureyString = window.location.search,
	urlParam = new URLSearchParams(qureyString),
	id = urlParam.get('id');
function createPage(e) {
	let t = document.getElementById('productImage'),
		a = document.createElement('div'),
		l = e.imageUrl;
	t.classList.add('container-fluid', 'p-0', 'col-xl-6'),
		(t.innerHTML +=
			'<img src="' +
			l +
			'" alt="Teddy Bear" class="img-fluid" style="height:100%; width:100%; object-fit:cover;">'),
		t.appendChild(a);
	let n = document.getElementById('productCard'),
		r = document.createElement('div'),
		d = e.name,
		i = e.description,
		s = e.price;
	r.classList.add('mx-auto'),
		n.classList.add('col-xl-6', 'p-0'),
		(r.innerHTML +=
			'<h1 class="mx-auto shop-item-title w-auto">' + d + '</h1>'),
		(r.innerHTML += '<p class="lead mx-auto w-auto">' + i + '</p>'),
		(r.innerHTML +=
			'<p class="lead mx-auto font-weight-bolder">$' + s / 100 + '</p>');
	let o = document.createElement('form'),
		c = document.createElement('label'),
		p = document.createElement('select');
	o.classList.add('my-4'),
		p.classList.add('btn', 'btn-secondary', 'dropdown-toggle', 'w-auto'),
		c.classList.add('font-weight-bold'),
		(c.innerHTML = 'Choose your color&#58; &nbsp;');
	let m = document.createElement('form'),
		u = document.createElement('label'),
		h = document.createElement('select');
	for (let g in (m.classList.add('my-4'),
	h.classList.add('btn', 'btn-secondary', 'dropdown-toggle', 'w-auto'),
	u.classList.add('font-weight-bold'),
	(u.innerHTML = 'Quantity&#58; &nbsp;'),
	e.colors)) {
		let C = document.createElement('option');
		(C.innerHTML = e.colors[g]),
			C.setAttribute('value', e.colors[g]),
			p.appendChild(C);
	}
	let L = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
	for (let b in L) {
		let f = document.createElement('option');
		(f.innerHTML = L[b]), f.setAttribute('value', L[b]), h.appendChild(f);
	}
	m.appendChild(u), m.appendChild(h), o.appendChild(c), o.appendChild(p);
	let y = document.createElement('button'),
		E = document.createElement('div');
	y.setAttribute('type', 'submit'),
		y.classList.add(
			'btn',
			'btn-primary',
			'add-to-cart',
			'rounded',
			'w-75',
			'align-self-center',
			'my-5'
		),
		(y.textContent = 'Add to Cart'),
		y.addEventListener('click', () => {
			let t = [],
				a = localStorage.getItem('cart');
			t = null === a ? [] : JSON.parse(a);
			let l = parseInt(h.value);
			for (let n = 0; n < l; n++) {
				let r = {
					imageUrl: e.imageUrl,
					name: e.name,
					id: e._id,
					price: e.price,
					selectColors: p.value,
					quantity: 1,
				};
				t.push(r);
			}
			localStorage.setItem('cart', JSON.stringify(t)), addNumCart();
		}),
		(y.onclick = () => {
			E.classList.add(
				'alert',
				'alert-success',
				'p-1',
				'm-0',
				'text-center',
				'w-75',
				'align-self-center'
			),
				E.setAttribute('role', 'alert'),
				(E.textContent =
					h.value +
					' ' +
					e.name +
					' with ' +
					p.value +
					' Color added to cart!');
		}),
		n.appendChild(r),
		n.appendChild(o),
		n.appendChild(m),
		n.appendChild(y),
		n.appendChild(E);
}
function addNumCart() {
	let e = localStorage.getItem('cart');
	if (e) {
		let t = JSON.parse(e);
		document.querySelector('.cartItemsTotal').innerHTML = t.length;
	}
}
fetch('https://orinoco-ncsr.onrender.com/api/teddies/' + id)
	.then(function (e) {
		return e.json();
	})
	.then(function (e) {
		createPage(e);
	})
	.catch(function (e) {
		console.log(e),
			(document.getElementById('productImageRow').innerHTML =
				'<h2 class = "mx-auto mt-5 text-center"> We\'re sorry the server is unavailable</h2>');
	}),
	addNumCart();
